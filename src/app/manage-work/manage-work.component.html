<section class="min-h-screen text-gray-400 bg-gray-900 body-font font-sans">
  <app-header></app-header>
  <div class="mx-auto flex px-5 py-8 flex-col items-center">
    <div class="items-start text-left items-center text-center">
      <h1 class="title-font text-xl sm:text-3xl mb-4 font-medium text-white">Gestisci i tuoi interventi</h1>
      <div class="flex flex-row items-center mb-8">
        <p class="mr-2 leading-relaxed">Filtra per:</p>
        <form [formGroup]="filterForm">
          <select (change)="select($event, 'site')"
                  class="h-[42px] w-[200px] bg-gray-800 rounded bg-opacity-40 border border-gray-700 focus:ring-2 focus:ring-purple-900 focus:bg-transparent focus:border-purple-500 text-base outline-none text-gray-100 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                  id="filter">
            <option disabled hidden selected value="">Seleziona commessa</option>
            <option *ngFor="let site of sites;"
                    [value]="site['Site']['id']" class="bg-gray-800">
              {{site['Site']['code']}} - {{site['Site']['description']}}
            </option>
          </select>
        </form>
      </div>
      <div class="flex justify-center">
        <table *ngIf="!error; else e" [dataSource]="work" class="mat-elevation-z16 bg-gray-800 border-b" mat-table>
          <ng-container matColumnDef="date">
            <th *matHeaderCellDef mat-header-cell>Data</th>
            <td *matCellDef="let item" mat-cell> {{item['Work']['date'] | date:'dd/MM/yyyy'}} </td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th *matHeaderCellDef class="hidden md:table-cell" mat-header-cell>Durata</th>
            <td *matCellDef="let item" class="hidden md:table-cell"
                mat-cell> {{item['Work']['intervention_duration'] | slice:0:5}} </td>
          </ng-container>

          <ng-container matColumnDef="type">
            <th *matHeaderCellDef class="hidden md:table-cell" mat-header-cell>Tipo</th>
            <td *matCellDef="let item" class="hidden md:table-cell"
                mat-cell> {{item['Work']['intervention_type']}} </td>
          </ng-container>

          <ng-container matColumnDef="location">
            <th *matHeaderCellDef class="hidden md:table-cell" mat-header-cell>Location</th>
            <td *matCellDef="let item" class="hidden md:table-cell"
                mat-cell> {{item['Work']['intervention_location']}} </td>
          </ng-container>

          <ng-container matColumnDef="client">
            <th *matHeaderCellDef class="hidden md:table-cell" mat-header-cell>Cliente</th>
            <td *matCellDef="let item" class="hidden md:table-cell" mat-cell> {{item['client_name']}} </td>
          </ng-container>

          <ng-container matColumnDef="site">
            <th *matHeaderCellDef mat-header-cell>Commessa</th>
            <td *matCellDef="let item" mat-cell> {{item['site_description']}} </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th *matHeaderCellDef mat-header-cell></th>
            <td *matCellDef="let item" class="space-x-4 whitespace-nowrap" mat-cell>
              <a (click)="editWork(item['Work']['id'])">
                <fa-icon [icon]="fa_info" [size]="fa_size"
                         class="cursor-pointer transition duration-150 ease-in-out hover:bg-opacity-10 hover:text-neutral-100"></fa-icon>
              </a>
              <a (click)="deleteWork(item['Work']['id'])">
                <fa-icon [icon]="fa_trash" [size]="fa_size"
                         class="cursor-pointer transition duration-150 ease-in-out hover:bg-opacity-10 hover:text-neutral-100"></fa-icon>
              </a>
            </td>
          </ng-container>
          <tr *matHeaderRowDef="displayed_columns" mat-header-row></tr>
          <tr *matRowDef="let row; columns: displayed_columns;" mat-row></tr>
        </table>
      </div>
      <ng-template #e>
        <div class="flex flex-col items-center">
          <fa-icon [icon]="fa_exclamation_circle" [size]="fa_size" class="text-red-500"></fa-icon>
          <p class="text-red-500">{{error}}</p>
        </div>
      </ng-template>
    </div>
  </div>
</section>
